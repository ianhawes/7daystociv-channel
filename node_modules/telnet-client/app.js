var telnet = require('./lib/index')
var telnet_server = require('telnet')

var srv = telnet_server.createServer(function(c) {
  c.write(new Buffer("BusyBox v1.19.2 () built-in shell (ash)\n"
    + "Enter 'help' for a list of built-in commands.\n\n/ # ", 'ascii'))

  c.on('data', function() {
    c.write(new Buffer("uptime\r\n23:14  up 1 day, 21:50, 6 users, "
      + "load averages: 1.41 1.43 1.41\r\n", 'ascii'))
    c.write(new Buffer("/ # ", 'ascii'))
  })
})

srv.listen(2323, function() {
    var connection = new telnet()

    var params = { 
      host: '127.0.0.1',
      port: 2323,
      shellPrompt: '/ # ',
      timeout: 1500
    }   

    connection.on('ready', function(prompt) {
      connection.exec('uptime', function(err, resp) {
        console.log(err, resp)

        connection.end()
      })  
    })  

    connection.connect(params);
})

/*
var params = {
  host: '127.0.0.1',
  port: 8080,
  negotiationMandatory: false
}

c.on('failedlogin', function() {
  console.log('login failed')
})

c.on("connect", function() {
  console.log('sending data')

  c.send('something', {
    ors: '\r\n',
    waitfor: '\n'
  }, function(error, data) {
    console.log('received a response', data)
  })
})


c.connect(params).then(function() {
  setInterval(function() {
    console.log('sending')

    c.send('something', {
      ors: '\r\n',
      waitfor: '\n'
    }, function(error, data) {
      console.log('received a response:', error, data)
    })
  }, 2000)
})
*/

